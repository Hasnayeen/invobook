<template>
<div v-if="discussionDetailsShown">
  <div class="absolute container mx-auto md:w-5/6 lg:4/5 xl:w-3/4 xxl:w-2/3 z-10 mb-16" style="top: 12vh;left: 0;right: 0;">
    <div class="bg-gray-100 rounded shadow-lg py-8">
      <div class="flex flex-row justify-between relative px-8">
        <div @click="closeDiscussionDetails" class="cursor-pointer">
          <font-awesome-icon :icon="faArrowLeft"
            class="text-base text-gray-600">
          </font-awesome-icon>
        </div>
        <div @click="toggleMenu" v-click-outside="hideMenu" class="cursor-pointer">
          <font-awesome-icon :icon="faEllipsisH"
            class="text-base text-gray-600">
          </font-awesome-icon>
        </div>
        <div v-if="dropdownMenuShown" class="absolute rounded shadow-lg right-0 top-0 mt-6 p-3 text-gray-800 hover:bg-gray-400">
          <div @click="deleteDiscussion" class="cursor-pointer">
            Delete
          </div>
        </div>
      </div>

      <div :data-discussion-id="discussion.id" class="text-gray-900 text-left text-3xl font-medium py-4 px-16">
        {{ discussion.name }}
      </div>
      <div class="flex flex-row justify-start items-center pb-4 px-16">
        <img :src="generateUrl(discussion.creator.avatar)" class="rounded-full w-10 h-10">
        <div class="text-gray-800 text-sm ml-4">
          <div>
            {{ discussion.creator.name }}
          </div>
          <div>
            {{ discussion.date }}
          </div>
        </div>
      </div>
      <div v-html="discussion.content" class="py-8 px-16 bg-white text-gray-900"></div>

      <comment-box resourceType="discussion" :resource="discussion" :detailsShown="discussionDetailsShown" class="px-16"></comment-box>
    </div>
    <div class="h-16"></div>
  </div>

  <div @click="closeDiscussionDetails" class="h-screen w-screen fixed inset-0 bg-gray-900 opacity-25"></div>
</div>
</template>

<script>
import commentBox from './commentBox.vue'
import {
  faArrowLeft,
  faEllipsisH
} from '@fortawesome/free-solid-svg-icons'

export default {
  components: {
    commentBox
  },
  props: {
    discussionDetailsShown: {
      required: true,
      type: Boolean
    },
    discussion: {
      required: true,
      type: Object
    },
    index: {
      required: true
    }
  },
  data () {
    return {
      dropdownMenuShown: false,
      faArrowLeft,
      faEllipsisH
    }
  },
  methods: {
    closeDiscussionDetails () {
      this.dropdownMenuShown = false
      this.$emit('close')
    },
    toggleMenu () {
      this.dropdownMenuShown = !this.dropdownMenuShown
    },
    hideMenu () {
      this.dropdownMenuShown = false
    },
    deleteDiscussion () {
      axios.delete(`/discussions/${this.discussion.id}`)
        .then((response) => {
          this.$emit('deleted', this.index)

          this.closeDiscussionDetails()

          EventBus.$emit('notification', response.data.message, response.data.status)
        })
        .catch((error) => {
          this.closeDiscussionDetails()

          EventBus.$emit('notification', error.response.data.message, error.response.data.status)
        })
    }
  }
}
</script>
